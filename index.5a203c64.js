var t={};class e{static STATUS={idle:"idle",playing:"playing",win:"win",lose:"lose"};constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.status=e.STATUS.idle,this.initialState=t,this.state=t.map(t=>[...t]),this.score=0}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status=e.STATUS.playing,this.getRandomBlock(),this.getRandomBlock()}restart(){this.status=e.STATUS.idle,this.state=this.initialState.map(t=>[...t]),this.score=0}getRandomBlock(){let t=this.state.reduce((t,e,s)=>(e.forEach((e,a)=>{0===e&&t.push([s,a])}),t),[]);if(t.length>0){let[e,s]=t[Math.floor(Math.random()*t.length)];this.state[e][s]=.9>Math.random()?2:4}}moveLeft(){this.move(t=>t,(t,e)=>this.state[e]=t)}moveRight(){this.move(t=>t.reverse(),(t,e)=>this.state[e]=t.reverse())}moveUp(){this.status===e.STATUS.playing&&this.move((t,e)=>this.getColumn(e),(t,e)=>this.setColumn(t,e))}moveDown(){this.status===e.STATUS.playing&&this.move((t,e)=>this.getColumn(e).reverse(),(t,e)=>this.setColumn(t.reverse(),e))}move(t,s){if(this.status!==e.STATUS.playing)return;let a=!1;for(let e=0;e<4;e++){let i=t(this.state[e],e),[r]=this.combineAndShift(i);r.toString()!==i.toString()&&(a=!0),s(r,e)}a&&(this.getRandomBlock(),this.checkGameOverOrWin())}getColumn(t){return this.state.map(e=>e[t])}setColumn(t,e){t.forEach((t,s)=>{this.state[s][e]=t})}combineAndShift(t){let e=t.filter(t=>0!==t),s=!1;for(let t=0;t<e.length-1;t++)e[t]===e[t+1]&&(e[t]*=2,this.score+=e[t],e[t+1]=0,s=!0);for(e=e.filter(t=>0!==t);e.length<4;)e.push(0);return[e,s]}checkGameOverOrWin(){if(this.state.flat().includes(2048)){this.status=e.STATUS.win;return}this.canMove()||(this.status=e.STATUS.lose)}canMove(){for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(0===this.state[t][e]||e<3&&this.state[t][e]===this.state[t][e+1]||t<3&&this.state[t][e]===this.state[t+1][e])return!0;return!1}}const s=new(t=e),a=document.querySelector(".start"),i=document.querySelector(".game-score"),r=document.querySelector(".game-field"),n=document.querySelector(".message-start"),o=document.querySelector(".message-lose"),c=document.querySelector(".message-win");function l(){i.textContent=s.getScore()}function h(){switch(s.getStatus()){case t.STATUS.win:c.classList.remove("hidden");break;case t.STATUS.lose:o.classList.remove("hidden")}}function d(){r.innerHTML="",s.getState().forEach((t,e)=>{let s=document.createElement("tr");t.forEach((t,e)=>{let a=document.createElement("td");a.textContent=0!==t?t:"",a.classList.add("field-cell"),0!==t&&a.classList.add(`field-cell--${t}`),s.appendChild(a)}),r.appendChild(s)})}a.addEventListener("click",()=>{switch(!0){case a.classList.contains("start"):s.start(),a.classList.remove("start"),a.classList.add("restart"),a.textContent="Restart";break;case a.classList.contains("restart"):s.restart(),a.classList.remove("restart"),a.classList.add("start"),a.textContent="Start"}n.classList.add("hidden"),o.classList.add("hidden"),c.classList.add("hidden"),d(),l(),h()}),document.addEventListener("keydown",t=>{switch(t.key){case"ArrowRight":s.moveRight();break;case"ArrowLeft":s.moveLeft();break;case"ArrowUp":s.moveUp();break;case"ArrowDown":s.moveDown()}d(),l(),h()}),l(),d(),h();
//# sourceMappingURL=index.5a203c64.js.map
